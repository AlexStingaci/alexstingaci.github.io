<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Homework 2 — Datasets & Distributions</title>

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Serif:wght@400;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --page-max: 760px;
      --ink: #111;
      --muted: #666;
      --line: #e6e6e6;
      --bg: #fff;
    }

    *, *::before, *::after { box-sizing: border-box; }
    html, body { height: 100%; }
    body{
      margin: 0;
      font-family: "IBM Plex Serif", Georgia, "Times New Roman", serif;
      color: var(--ink);
      background: var(--bg);
      line-height: 1.65;
    }

    .page{
      max-width: var(--page-max);
      margin: 48px auto 96px;
      padding: 0 20px;
    }

    header{
      margin-bottom: 28px;
      border-bottom: 1px solid var(--line);
      padding-bottom: 16px;
    }
    h1{
      margin: 0 0 6px 0;
      font-weight: 600;
      font-size: clamp(26px, 4vw, 36px);
      letter-spacing: .2px;
    }

    section + section { margin-top: 24px; }
    h2{
      margin: 0 0 10px 0;
      font-size: clamp(18px, 2.6vw, 22px);
      font-weight: 600;
    }
    p{ margin: 0; }
    p + p { margin-top: 10px; }

    /* Simple gallery: images shown IN FULL (no cropping, no figure) */
    .gallery{
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
      margin-top: 16px;
    }
    @media (min-width: 880px){
      .gallery{ grid-template-columns: 1fr 1fr; }
    }
    .photo{
      border: 1px solid var(--line);
      background: #fff;
      padding: 12px;
    }
    .photo img{
      display: block;
      width: 100%;
      height: auto;        /* keep full image, no cropping */
      object-fit: contain; /* safety: never crop */
    }

    a{ color: inherit; text-underline-offset: 3px; }
    a:hover{ color: #000; }

    @media print{
      .page{ margin: 0; padding: 0; max-width: none; }
      header{ border: 0; padding-bottom: 0; margin-bottom: 16px; }
      .gallery{ grid-template-columns: 1fr 1fr; gap: 12px; }
      .photo{ border-color: #ddd; }
    }

    /* ====================== CAESAR TOOL ====================== */
    .cesare{ margin-top: 28px; border-top: 1px solid var(--line); padding-top: 20px; }
    .muted{ color: var(--muted); font-size: 14px; }

    .cesare-grid{
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-top: 12px;
    }
    @media (max-width: 880px){
      .cesare-grid{ grid-template-columns: 1fr; }
    }

    .cesare-card{
      background: #fafafa;
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 14px;
    }
    .cesare-card h3{ margin: 0 0 8px 0; font-size: 18px; }
    .cesare-textarea{
      width: 100%; min-height: 160px; resize: vertical; padding: 10px 12px;
      border-radius: 10px; border: 1px solid var(--line); background: #fff;
      font: 14px/1.6 ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
    }
    .cesare-row{ display: flex; gap: 12px; align-items: center; flex-wrap: wrap; margin-top: 8px; }
    .badge{
      display: inline-flex; align-items: center; gap: 6px;
      background: #f0f0ff; color: #27276a; border: 1px solid #dadcff;
      padding: 3px 8px; border-radius: 999px; font-size: 12px;
    }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }

    .cesare-charts{ display: grid; gap: 14px; }
    .cesare-chart{
      border: 1px solid var(--line); border-radius: 12px; padding: 10px 10px 24px; background: #fff;
    }
    .cesare-chart-head{ display: flex; align-items: baseline; gap: 8px; margin: 0 0 8px 2px; }
    .cesare-title{ font-size: 15px; font-weight: 600; }
    .cesare-sub{ color: var(--muted); font-size: 13px; margin-left: auto; }

    .axis{
      position: relative; height: 240px; border-left: 1px solid var(--line); border-bottom: 1px solid var(--line); padding: 8px 0 0 8px;
    }
    .bars{
      position: absolute; inset: 8px 0 0 8px; display: grid; grid-template-columns: repeat(26, 1fr); align-items: end; gap: 6px;
    }
    .bar{ position: relative; height: 100%; display: flex; flex-direction: column; justify-content: flex-end; align-items: center; gap: 6px; }
    .rect{ width: 100%; border-radius: 6px 6px 0 0; background: #b9c3cf; height: var(--h, 0%); transition: height .2s ease; }
    .bar.alt .rect{ background: #9ec5ff; }
    .val{
      position: absolute; bottom: calc(var(--h,0%) + 8px); transform: translateY(50%); font-size: 12px; color: #0b1220; opacity: .8; user-select: none;
    }
    .labels{ display: grid; grid-template-columns: repeat(26, 1fr); gap: 6px; margin-top: 6px; color: #0b1220; }
    .labels span{ font-size: 12px; text-align: center; user-select: none; }

    .table{
      width: 100%; border-collapse: collapse; font-size: 13px; background: #fff; border: 1px solid var(--line); border-radius: 10px; overflow: hidden;
    }
    .table thead th{ background: #f6f7fb; text-align: left; padding: 8px; border-bottom: 1px solid var(--line); }
    .table td{ padding: 8px; border-top: 1px solid var(--line); vertical-align: top; }
    .preview{ white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 420px; }
    .out{
      width: 100%; min-height: 120px; resize: vertical; padding: 10px 12px;
      border: 1px solid var(--line); border-radius: 10px; background: #fff;
      font: 14px/1.6 ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
    }
    .slider{ display: flex; align-items: center; gap: 10px; }
    .slider input[type="range"]{ width: 220px; }
  </style>
</head>
<body>
  <main class="page">
    <header>
      <h1>Homework 2 — Datasets & Distributions</h1>
    </header>

    <section aria-labelledby="dataset">
      <h2 id="dataset">What is a dataset?</h2>
      <p>A dataset is a structured collection of related data, usually organized in rows and columns, that represents information about a specific topic or domain. Each row typically corresponds to an individual observation or record, while each column represents a variable or attribute describing those observations. Datasets are fundamental in data analysis, statistics, and machine learning, as they provide the raw material for discovering patterns, testing hypotheses, and building predictive models.</p> <p>In practical applications, datasets are used for a variety of purposes — from academic research and business intelligence to training artificial intelligence systems. A well-prepared dataset ensures that analyses and models are reliable, interpretable, and reproducible.</p>
    </section>

    <section aria-labelledby="distribution">
      <h2 id="distribution">What is a distribution?</h2>
      <p>A distribution describes how the values of a variable are spread or arranged across different possible outcomes. In other words, it shows how often each value or range of values occurs within a dataset. Understanding the distribution of data is essential in statistics because it reveals patterns, tendencies, and variability within the data.</p> <p>Distributions can be represented in various forms, such as tables, graphs, or mathematical functions. In general, analyzing a distribution helps identify key statistical measures such as the mean, median, mode, variance, and standard deviation, providing insights into the central tendency and spread of the data.</p>

    <section class="examples" aria-labelledby="examples">
      <h2 id="examples">Univariate and bivariate views</h2>

      <!-- Images shown IN FULL, no <figure>, no captions -->
      <div class="gallery">
        <div class="photo">
          <img src="db.png" alt="Database schema: tables and keys">
        </div>
        <div class="photo">
          <img src="query_1.png" alt="Query result: univariate distribution">
        </div>
        <div class="photo">
          <img src="ris1.png" alt="Histogram of variable X">
        </div>
        <div class="photo">
          <img src="quer_2.png" alt="Query result: bivariate relation">
        </div>
        <div class="photo">
          <img src="ris2.png" alt="Bivariate distribution chart">
        </div>
      </div>
    </section>

    <!-- ==================== CAESAR SECTION ==================== -->
    <section class="cesare" aria-labelledby="cesare-title">
      <h2 id="cesare-title">Letter frequencies & Caesar cipher (ciphertext)</h2>
      <p class="muted"><strong>Explanation:</strong> The box below contains <em>ciphertext</em>. The first histogram shows its letter counts (A–Z). The second histogram applies a Caesar shift of <span id="hist-label" class="mono">12</span> to the same ciphertext (reference only). The decoder ranks all 26 shifts using a chi-square test against typical English frequencies and suggests the most likely plaintext; you can also adjust the shift manually.</p>

      <div class="cesare-grid">
        <!-- Ciphertext input -->
        <section class="cesare-card" aria-labelledby="ciphertext-h3">
          <h3 id="ciphertext-h3">Ciphertext input</h3>
          <p class="muted"><strong>Explanation:</strong> Paste or edit ciphertext. Only A–Z letters are counted (diacritics removed); digits, spaces, and punctuation are ignored for charts.</p>
          <textarea id="text" class="cesare-textarea" spellcheck="false" placeholder="Paste your ciphertext here…">Ftq cguow ndaiz raj vgybe ahqd ftq xmlk pas. Bmow yk naj iuft ruhq palqz xucgad vgse.</textarea>
          <div class="cesare-row">
            <span class="badge">Filtered: letters only</span>
            <span id="totals" aria-live="polite">Total letters: …</span>
          </div>
        </section>

        <!-- Histograms -->
        <section class="cesare-card" aria-labelledby="hist-h3">
          <h3 id="hist-h3">Histograms</h3>
          <p class="muted"><strong>Explanation:</strong> Left: frequencies in the ciphertext. Right: ciphertext shifted by <span class="mono" id="hist-label-2">12</span> (not decryption). Use the slider to choose the reference shift.</p>

          <!-- Reference-shift slider -->
          <div class="slider" style="margin:8px 0 12px;">
            <label for="hist-shift">Histogram shift</label>
            <input id="hist-shift" type="range" min="0" max="25" step="1" value="12" />
            <span class="mono" id="hist-shift-value">12</span>
          </div>

          <div class="cesare-charts">
            <div class="cesare-chart" aria-label="Ciphertext histogram">
              <div class="cesare-chart-head">
                <div class="cesare-title">Letter frequencies (ciphertext)</div>
                <div class="cesare-sub" id="sub-original"></div>
              </div>
              <div class="axis">
                <div class="bars" id="bars-original"></div>
              </div>
              <div class="labels" id="labels-original"></div>
            </div>

            <div class="cesare-chart" aria-label="Ciphertext shifted by chosen amount">
              <div class="cesare-chart-head">
                <div class="cesare-title">Ciphertext shifted by <span class="mono" id="hist-title-shift">12</span> (reference)</div>
                <div class="cesare-sub" id="sub-caesar"></div>
              </div>
              <div class="axis">
                <div class="bars" id="bars-caesar"></div>
              </div>
              <div class="labels" id="labels-caesar"></div>
            </div>
          </div>
        </section>
      </div>

      <!-- Decoder -->
      <section class="cesare-card" style="margin-top:16px;" aria-labelledby="decoder-h3">
        <h3 id="decoder-h3">Caesar cipher decoder (frequency analysis)</h3>
        <p class="muted"><strong>Explanation (how it works):</strong></p>
        <ul class="muted" style="margin-top:8px">
          <li><strong>Sanitize.</strong> Convert text to A–Z only (uppercase, diacritics removed) so counts aren’t biased by punctuation or accents.</li>
          <li><strong>Count.</strong> Compute observed letter counts <span class="mono">O<sub>A..Z</sub></span> in the ciphertext.</li>
          <li><strong>Try every shift (0–25).</strong> For a candidate shift <span class="mono">s</span>, “undo” it on the counts (i.e., rotate counts backward by <span class="mono">s</span>) to approximate the plaintext distribution.</li>
          <li><strong>Score by chi-square.</strong> Compare the rotated counts to expected English frequencies <span class="mono">E<sub>i</sub> = p<sub>i</sub> · N</span> using
            <span class="mono">χ² = Σ (O<sub>i</sub> − E<sub>i</sub>)² / E<sub>i</sub></span>. Lower is better.</li>
          <li><strong>Pick the best.</strong> The shift with the lowest <span class="mono">χ²</span> is used to decode the text shown below. Short or non-English samples may mislead the score.</li>
        </ul>

        <div class="cesare-row" style="margin-top:6px;">
          <span class="badge">Assumption: English plaintext</span>
          <span id="sample-note" class="muted"></span>
          <span id="best-note" class="mono"></span>
        </div>

        <div style="margin-top:10px; overflow-x:auto;">
          <table class="table" aria-label="Best shifts by chi-squared score">
            <thead>
              <tr>
                <th style="width:80px;">Shift</th>
                <th style="width:120px;">Chi-square ↓</th>
                <th>Preview (decoded)</th>
              </tr>
            </thead>
            <tbody id="rank-body"></tbody>
          </table>
        </div>

        <div class="cesare-grid" style="grid-template-columns: 1fr 1fr; margin-top:14px;">
          <div class="cesare-card">
            <div class="cesare-chart-head">
              <div class="cesare-title">Auto-decoded (best shift: <span id="auto-shift" class="mono">–</span>)</div>
            </div>
            <textarea id="auto-out" class="out" readonly></textarea>
          </div>

          <div class="cesare-card">
            <div class="cesare-chart-head">
              <div class="cesare-title">Manual decryption</div>
            </div>
            <div class="slider">
              <label for="manual-shift">Shift</label>
              <input id="manual-shift" type="range" min="0" max="25" step="1" value="12" />
              <span class="mono" id="manual-label">12</span>
            </div>
            <textarea id="manual-out" class="out" readonly></textarea>
          </div>
        </div>
      </section>
    </section>
    <!-- /cesare -->
  </main>

  <script>
    // =============== Config & constants ===============
    const A_CODE = 'A'.charCodeAt(0);
    const LETTERS = Array.from({length:26}, (_,i)=> String.fromCharCode(A_CODE+i));

    // English letter frequencies (A..Z) in percent
    const EN_FREQ = {
      A:8.167, B:1.492, C:2.782, D:4.253, E:12.702, F:2.228, G:2.015, H:6.094, I:6.966, J:0.153, K:0.772,
      L:4.025, M:2.406, N:6.749, O:7.507, P:1.929, Q:0.095, R:5.987, S:6.327, T:9.056, U:2.758, V:0.978,
      W:2.360, X:0.150, Y:1.974, Z:0.074
    };
    const EN_PROPS = LETTERS.map(l => EN_FREQ[l]/100);

    // ====================== Utils ======================
    function stripDiacritics(s){ return s.normalize('NFD').replace(/[\u0300-\u036f]/g, ''); }
    function onlyAZ(s){ return stripDiacritics(s).toUpperCase().replace(/[^A-Z]/g, ''); }
    function countAZ(s){
      const counts = new Array(26).fill(0);
      for(const ch of s){
        const idx = ch.charCodeAt(0) - A_CODE;
        if(idx>=0 && idx<26) counts[idx]++;
      }
      return counts;
    }
    function rotateCounts(counts, shift){
      const out = new Array(26).fill(0);
      const s = ((shift % 26) + 26) % 26;
      for(let i=0;i<26;i++){
        const j = (i + s) % 26;
        out[j] = counts[i] + (out[j]||0);
      }
      return out;
    }
    function sum(arr){ return arr.reduce((a,b)=>a+b,0); }
    function max(arr){ return arr.reduce((m,v)=> v>m? v:m, 0); }

    // Caesar decode text (preserves case, skips non A–Z)
    function caesarDecodeText(text, shift){
      const s = ((shift % 26) + 26) % 26;
      return text.replace(/[A-Za-z]/g, ch=>{
        const base = ch <= 'Z' ? 65 : 97;
        const code = ch.charCodeAt(0) - base;
        const dec  = (code - s + 26) % 26;
        return String.fromCharCode(base + dec);
      });
    }

    // Chi-squared score
    function chiSquared(observedCounts, total, expectedProps){
      let score = 0;
      for(let i=0;i<26;i++){
        const expected = expectedProps[i] * total;
        const diff = observedCounts[i] - expected;
        if(expected > 0) score += (diff * diff) / expected;
      }
      return score;
    }
    function rankShiftsByChi2(cipherCounts, total){
      const results = [];
      for(let s=0; s<26; s++){
        // decoding by s == rotate counts backward by s -> forward by (26 - s)
        const decodedCounts = rotateCounts(cipherCounts, (26 - s) % 26);
        const score = chiSquared(decodedCounts, total, EN_PROPS);
        results.push({ shift: s, score });
      }
      results.sort((a,b)=> a.score - b.score);
      return results;
    }

    // ================== Rendering helpers ==================
    function createSkeleton(barsEl, labelsEl, alt=false){
      barsEl.innerHTML = '';
      labelsEl.innerHTML = '';
      LETTERS.forEach(letter=>{
        const col = document.createElement('div');
        col.className = 'bar' + (alt? ' alt' : '');
        const rect = document.createElement('div');
        rect.className = 'rect';
        const val = document.createElement('div');
        val.className = 'val';
        val.textContent = '0';
        col.appendChild(rect);
        col.appendChild(val);
        barsEl.appendChild(col);

        const lab = document.createElement('span');
        lab.textContent = letter;
        labelsEl.appendChild(lab);
      });
    }
    function renderCounts(barsEl, counts){
      const maxVal = Math.max(1, max(counts));
      const bars = barsEl.querySelectorAll('.bar');
      counts.forEach((c, i)=>{
        const bar = bars[i];
        const rect = bar.querySelector('.rect');
        const val = bar.querySelector('.val');
        const h = (c / maxVal) * 100;
        rect.style.setProperty('--h', h.toFixed(2) + '%');
        val.textContent = c;
      });
    }

    // ================ Charts & Decoder ================
    function getHistogramShift(){
      const el = document.getElementById('hist-shift');
      return el ? parseInt(el.value, 10) : 12;
    }

    function updateCharts(cleanAZ){
      const counts = countAZ(cleanAZ);
      const totals = sum(counts);
      document.getElementById('totals').textContent = `Total letters: ${totals}`;

      renderCounts(document.getElementById('bars-original'), counts);
      document.getElementById('sub-original').textContent = totals ? `max: ${max(counts)}` : 'no data';

      const histShift = getHistogramShift();
      const shifted = rotateCounts(counts, histShift);
      renderCounts(document.getElementById('bars-caesar'), shifted);
      document.getElementById('sub-caesar').textContent = totals ? `max: ${max(shifted)}` : 'no data';

      return {counts, totals};
    }

    function updateDecoder(cipherText, cipherCounts, totals){
      const tbody = document.getElementById('rank-body');
      const autoOut = document.getElementById('auto-out');
      const manualOut = document.getElementById('manual-out');
      const autoShiftLabel = document.getElementById('auto-shift');
      const bestNote = document.getElementById('best-note');
      const sampleNote = document.getElementById('sample-note');
      const slider = document.getElementById('manual-shift');
      const sliderLbl = document.getElementById('manual-label');

      if(totals < 40){ sampleNote.textContent = 'Warning: small sample size; the guess may be unreliable.'; }
      else { sampleNote.textContent = ''; }

      if(totals === 0){
        tbody.innerHTML = '<tr><td colspan="3">No letters to analyze.</td></tr>';
        autoOut.value = '';
        manualOut.value = '';
        autoShiftLabel.textContent = '–';
        bestNote.textContent = '';
        return;
      }

      const ranks = rankShiftsByChi2(cipherCounts, totals);
      const best = ranks[0];
      autoShiftLabel.textContent = String(best.shift);
      bestNote.textContent = `best χ² = ${best.score.toFixed(2)}`;

      const top = ranks.slice(0, 5);
      tbody.innerHTML = top.map(r=>{
        const prev = caesarDecodeText(cipherText, r.shift).replace(/\s+/g,' ').slice(0, 100);
        const safePrev = prev.replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
        return `<tr>
          <td class="mono">${r.shift}</td>
          <td class="mono">${r.score.toFixed(2)}</td>
          <td class="preview" title="${safePrev}">${safePrev}</td>
        </tr>`;
      }).join('');

      autoOut.value = caesarDecodeText(cipherText, best.shift);

      slider.value = String(best.shift);
      sliderLbl.textContent = String(best.shift);
      manualOut.value = caesarDecodeText(cipherText, best.shift);
    }

    function updateAll(){
      const rawCipher = document.getElementById('text').value || '';
      const cleanAZ = onlyAZ(rawCipher);
      const {counts, totals} = updateCharts(cleanAZ);
      updateDecoder(rawCipher, countAZ(cleanAZ), totals);
    }
    function updateChartsOnly(){
      const rawCipher = document.getElementById('text').value || '';
      const cleanAZ = onlyAZ(rawCipher);
      updateCharts(cleanAZ);
    }

    // ======================= Init =======================
    (function init(){
      createSkeleton(
        document.getElementById('bars-original'),
        document.getElementById('labels-original'),
        false
      );
      createSkeleton(
        document.getElementById('bars-caesar'),
        document.getElementById('labels-caesar'),
        true
      );

      // Sync initial labels for histogram shift
      const histSlider = document.getElementById('hist-shift');
      const histValue  = document.getElementById('hist-shift-value');
      const histLabel1 = document.getElementById('hist-label');
      const histLabel2 = document.getElementById('hist-label-2');
      const histTitle  = document.getElementById('hist-title-shift');

      function syncHistLabels(v){
        histValue.textContent = v;
        histLabel1.textContent = v;
        histLabel2.textContent = v;
        histTitle.textContent  = v;
      }
      syncHistLabels(histSlider.value);

      // Events
      document.getElementById('text').addEventListener('input', updateAll);

      // Slider: histogram shift (updates only charts)
      histSlider.addEventListener('input', ()=>{
        syncHistLabels(histSlider.value);
        updateChartsOnly();
      });

      // Slider: manual decryption
      const slider = document.getElementById('manual-shift');
      const sliderLbl = document.getElementById('manual-label');
      const manualOut = document.getElementById('manual-out');
      slider.addEventListener('input', ()=>{
        sliderLbl.textContent = slider.value;
        const rawCipher = document.getElementById('text').value || '';
        manualOut.value = caesarDecodeText(rawCipher, parseInt(slider.value, 10));
      });

      updateAll(); // first render
    })();
  </script>
</body>
</html>
